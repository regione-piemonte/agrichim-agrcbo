<html>
<head>
<title>Servizio AGRICHIM</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-cache">
<script src="../layout/js/gestione.js"></script>
<script src="../layout/js/testLength.js"></script>
<link href="../layout/css/format.css" rel="stylesheet" type="text/css">

</head>
<body bgcolor="#CCCCCC">
<table summary="Questa tabella serve per formattare la pagina"  width="100%" border="0" cellspacing="0" cellpadding="0" height="100%">
  <tr align="center" valign="middle">
    <td>
      <table summary="Questa tabella serve per formattare la pagina" width="720" border="0" cellspacing="0" cellpadding="0" bgcolor="#FFFFFF">
        <tr>
          <td>
            <table summary="Questa tabella serve per formattare la pagina" width="720" border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td><img src="../layout/im/ban_sup.gif" width="638" height="40" alt="RuparPiemonte"></td>
              </tr>

              <tr valign="top" align="right">
                <td width="640">
                  <table width="719" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td background="../layout/im/pix-gri-ban.gif" width="1" height="2"><img src="../layout/im/tra_pix.gif" width="1" height="1"></td>
                      <td width="2" height="2" bgcolor="#319E84"><img src="../layout/im/tra_pix.gif" width="2" height="2"></td>
                      <td width="135" height="2" bgcolor="#319E84">
                        <div align="right"><img src="../layout/im/agricoltura.gif" alt="agricoltura" width="89" height="14">
                        </div>
                      </td>
                      <td width="585" height="2" background="../layout/im/pix_verde_nuovo.gif">&nbsp;&nbsp;
                        <img src="../layout/im/agrichim_nuovo.gif" alt="servizio agrichim" width="164" height="13" align="top">
                      </td>
                      <td height="1" background="../layout/im/pix_verde_nuovo.gif"><img src="../layout/im/tra_pix.gif" width="2" height="1"></td>
                      <td background="../layout/im/pix-gri-ban.gif" height="1"><img src="../layout/im/tra_pix.gif" width="1" height="1"></td>
                    </tr>
                    <tr>
                      <td background="../layout/im/pix-gri-ban.gif" width="1"><img src="../layout/im/tra_pix.gif" width="1" height="1"></td>
                      <td bgcolor="#319E84" width="2"><img src="../layout/im/tra_pix.gif" width="2" height="1"></td>
                      <td colspan="2">
                        <table width="100%" border="0" cellspacing="0" cellpadding="1">
                          <tr background="../layout/im/pix-gri-ban.gif">
                            <td background="../layout/im/pix-gri-ban.gif">
                              <table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <tr>
                                  <td width="134" valign="top" background="../layout/im/pix_verde_nuovo.gif">
                                    <div align="center"> <br>
                                      <br>
                                      <table width="124" height="50" border="0" align="center" cellpadding="0" cellspacing="5" background="../layout/im/sfondo_tab1.gif">
                                        <tr>
                                          <td>
                                            <p class="testoUtente"><strong>Utente:<br>
                                              ##nomeUtente</strong></p></td>
                                        </tr>
                                      </table>
                                      <br>
                                      <a href="../controller/nuovaAnalisi.jsp" target="_nuova_"><img src="../layout/im/tit_sx_nuovaAnalisi_off.gif" alt="prenotazione nuova analisi" width="124" height="29" border="0"></a><br>
                                      <br>
                                      <table width="124" height="142" border="0" cellpadding="2" cellspacing="0" background="../layout/im/pix_verde_nuovo.gif">
                                        <tr>
                                          <td><table width="100%" height="169" border="0" cellpadding="4" cellspacing="1" background="../layout/im/tit_sx_campioni_on3.gif">
                                              <tr>
                                                <td>&nbsp;</td>
                                              </tr>
                                              <tr bgcolor="#FFFFFF">
                                                <td bgcolor="#FFFFFF"><strong><span class="testoTabellelungheVerde"><a href="../controller/ricercaCampioni.jsp" class="testoTabellelungheVerdeON">Ricerca
                                                  campione</a></span></strong></td>
                                              </tr>
                                              <tr>
                                                <td bgcolor="#FFE193" class="testoTabellelungheVerdeON"><strong><a href="../controller/analisiRichieste.jsp" class="testoTabellelungheVerdeON">Analisi
                                                  richieste</a></strong></td>
                                              </tr>
                                              <tr>
                                                <td bgcolor="#FFFFFF" class="testoTabellelungheVerde"><strong><a href="../controller/campioniLaboratorio.jsp" class="testoTabellelungheVerdeON">Campioni
                                                  in laboratorio</a></strong></td>
                                              </tr>
                                              <tr>
                                                <td bgcolor="#FFFFFF" class="testoTabellelungheVerde"><strong><a href="../controller/analisiTerminate.jsp" class="testoTabellelungheVerdeON">Referti
                                                  da emettere</a></strong></td>
                                              </tr>
                                              <tr>
                                                <td bgcolor="#FFFFFF"><span class="testoTabellelungheVerde"><strong><a href="../controller/refertiEmessi.jsp" class="testoTabellelungheVerdeON">Referti
                                                  emessi</a></strong></span> </td>
                                              </tr>
                                            </table></td>
                                        </tr>
                                      </table>
                                      <a href="../controller/ricercaCampioni.jsp"><br>
                                      </a> <a href="javascript:pop2('anagraficaUtentePOP.htm');">
                                      </a><a href="../view/menuAnagrafiche.jsp"><img src="../layout/im/tit_sx_anagrafiche_off.gif" alt="anagrafiche" width="124" height="29" border="0"></a><br><br>
                                      <a href="../view/ricercaPreventivi.jsp"><img src="../layout/im/tit_sx_gestionePreventivi_off.gif" alt="gestione preventivi" width="124" height="29" border="0"></a><br><br>
                                      <a href="homeFrontOffice.htm"><br>
                                      </a> <a href="../view/menuTabelle.jsp"><img src="../layout/im/tit_sx_datisistema_off.gif" alt="dati di sistema" width="124" height="29" border="0"></a><br>
<!--                                       <br> -->
<!--                                       <a href="../view/utility.jsp"><img src="../layout/im/tit_sx_utilita_off.gif" alt="utilit&agrave;" width="124" height="29" border="0"></a> -->
                                      <br>
                                      <br>
                                      <a href="../controller/logout.jsp"><img src="../layout/im/tit_sx_logoutN_off.gif" alt="logout" width="124" height="29" border="0"><br>
                                      <br>
                                      </a> </div>



                                  </td>
                                  <td width="577" height="450" valign="top" bgcolor="#F2F1EA">
                                    <h1>Campioni - analisi richieste</h1>
                                    <h2> Modifica dati del campione </h2>
                                    <table width="560" border="0" cellspacing="0" cellpadding="0" align="center">
                                      <tr align="center" valign="top">
                                        <td width="20%" class="pul"><a href="../controller/ricercaCampioni.jsp" class="pul_pag">
                                          </a><a href="#" onClick="pop('../report/anagraficaCampione##codiceMateriale.pdf?idRichiesta=##idRichiesta',647,480,'pdf');" class="pul_pag">Scheda di accompagnamento</a></td>
                                        <td width="18%" class="pulselect">Modifica dati del campione</td>
                                        <td width="15%" class="pul"><a href="../view/annullaRichiesta.jsp" class="pul_pag">Annulla richiesta</a></td>
                                        <td width="15%" class="pul"><a href="../view/accettazioneScarto.jsp" class="pul_pag">Accettazione Scarto</a></td>
                                        <td width="15%" class="pul"><a class="pul_pag" href="#" onclick="controlli(aggiorna,'scarica','/jsp/controller/verificaPagamento.jsp')">Verifica il Pagamento</a></td>
                                        <td width="20%" class="pul"><a class="pul_pag" href="#" onclick="controlli(null,'scarica','');" style="cursor:hand">Scarica la ricevuta</a></td>
                                      </tr>
                                    </table>
                                    <br>
                                    <table width="466" border="0" align="center" cellpadding="0" cellspacing="0">
                                      <tr>
                                      <td width="144" align="bottom">&nbsp;</td>
                                      <td width="159" align="bottom"><a class="inseriti" 
                                            @@SiGis 
                                                href="../view/coordinatePrelievo.jsp" alt="coordinate prelievo" 
                                            @@SiGis 
                                            @@NoGis 
                                                href="javascript:alert('Questo tipo di materiale non richiede l\'inserimento delle cordinate del prelievo');"
                                            @@NoGis>coordinate<br>prelievo</td>
                                      <td width="163" align="bottom"><a class="inseriti" 
                                            @@SiGis 
                                                href="../controller/dati.jsp" 
                                            @@SiGis    
                                            @@NoGis
                                                href="javascript:alert('Funzione non disponibile per le matrici diverse dai terreni')"
                                            @@NoGis>caratteristiche<br>campione</a></td>
                                            
                                      </tr>
                                    </table>
                                    <table width="466" border="0" align="center" cellpadding="0" cellspacing="0">
                                      <tr>
                                        <td><div align="center"><img src="../layout/im/tit_ident_on.gif" alt="modifica dati del campione - menu di navigazione" width="466" height="22" border="0"></div></td>
                                      </tr>
                                    </table>
                                    <table width="466" border="0" align="center" cellpadding="0" cellspacing="0">
                                      <tr>
                                      <td width="65" align="top">&nbsp;</td>
                                      <td width="159" align="top"><a class="fuoco">identificativi<br>campione</a></td>
                                      <td width="166" align="top"><a class="inseriti " href="../view/datiAnagrafiche.jsp">utente e<br>proprietario</a></td><!-- ##disab -->
                                      <td width="76" align="top"><a class="disabilitato" href="">analisi<br>richiesta</a></td><!--  href="../controller/analisi.jsp -->
                                      </tr>
                                    </table>
                                    <br>
                                    <table width="98%" border="0" align="center">
                                    <form name="identificazioneCampione" method="post" action="../controller/identificazioneCampione.jsp">
                                      @@errore
                                      <tr>
                                        <td colspan="7" class="testoERRORE">I dati contrassegnati da &nbsp;<img src="../layout/im/ko.gif">&nbsp;
                                        non sono stati inseriti correttamente
                                          <br>
                                          <br>
                                        </td>
                                      </tr>
                                      @@errore
                                      @@modifica
                                      <tr>
                                        <td colspan="7" class="testoOK">Modifica effettuata correttamente
                                          <br>
                                          <br>
                                        </td>
                                      </tr>
                                      @@modifica

                                      <tr>
                                        <td colspan="7"> <p align="center"><strong>Dati
                                            identificativi del campione</strong></p></td>
                                      </tr>

                                      <tr>
                                        <td colspan="2">Numero della richiesta</td>
                                        <td width="70%" colspan="4"><input name="idRichiesta" value="##idRichiesta" type="text" disabled class="testoCampi" style="BACKGROUND-COLOR: #F0F0EF; COLOR: #000000" size="9" maxlength="9">
                                        <input id="idRichiesta" value="##idRichiesta" type="hidden">
                                        <input id="iuv"  value="##iuv" type="hidden">
                                        <input id="tipo_pagamento" value="##tipoPagamento" type="hidden">
                                        <input id="stato_pagamento" value="##statoPagamento" type="hidden"></td>
                                      </tr>
                                      <tr>
                                        <td colspan="2">Data inserimento richiesta
                                        <input name="giornoInserimentoRic" value="##giorno" type="hidden">
                                        <input name="meseInserimentoRic" value="##mese" type="hidden">
                                        <input name="annoInserimentoRic" value="##anno" type="hidden">
                                        </td>
                                        <td colspan="4"> <input name="giorno" type="text" value="##giorno" disabled class="testoCampi" style="BACKGROUND-COLOR: #F0F0EF; COLOR: #000000" size="2" maxlength="2">
                                          /
                                          <input name="mese" type="text" disabled value="##mese" class="testoCampi" style="BACKGROUND-COLOR: #F0F0EF; COLOR: #000000" size="2" maxlength="2">
                                          /
                                          <input name="anno" type="text" disabled value="##anno" class="testoCampi" style="BACKGROUND-COLOR: #F0F0EF; COLOR: #000000" size="4" maxlength="4">
                                        </td>
                                      </tr>
                                      <tr>
                                        <td colspan="2">Materiale/Matrice</font></font>
                                        <input name="descMateriale" value="##descMateriale" type="hidden">
                                        </td>
                                        <td colspan="4"> <input name="descMateriale" type="text" value="##descMateriale" disabled class="testoCampi" style="BACKGROUND-COLOR: #F0F0EF; COLOR: #000000" size="40" maxlength="40">
                                        </td>
                                      </tr>
                                      <tr>
                                        <td  colspan="2">Etichetta</font> </td>
                                        <td colspan="4"> <input name="etichettaCampione" value="##etichettaCampione" type="text" class="testoCampi" size="40" maxlength="40">
                                        ##errore1</td>
                                      </tr>
                                      <tr>
                                        <td  colspan="2">Tipo di consegna (*)</font></td>
                                        <td colspan="4">
                                         <select name="codModalitaConsegna" class="testoCampi">
                                                @@modalita
                                                  <option value="$$codice" $$selected>$$descrizione</option>
                                                @@modalita
                                         </select>
                                        </td>
                                      </tr>
                                      <tr>
                                        <td  colspan="2">Laboratorio di consegna (*)</font></td>
                                        <td colspan="4">
                                        <select name="codLaboratorio" class="testoCampi">
                                                @@laboratorio
                                                  <option value="$$codice" $$selected>$$descrizione</option>
                                                @@laboratorio
                                         </select> </td>
                                      </tr>
                                      <tr>
                                        <td colspan="2">Analisi svolta per adempimenti previsti da misure del Piano di Sviluppo Rurale (*)</td>
                                        <td colspan="4">
                                         <select name="codiceMisuraPsr" class="testoCampi">
                                            <option value="-1" onclick="isMotivoObbligatorio('N');">--------</option>
                                                @@codiceMisuraPsr
                                                  <option value="$$codice" $$selected onclick="isMotivoObbligatorio('$$motivoObbligatorio');">$$descrizione</option>
                                                @@codiceMisuraPsr
                                         </select> ##erroreCodiceMisuraPsr</td>
                                      </tr>                                      
                                      <tr>
                                        <td colspan="2">Motivazione adempimento misura PSR <span id="idMotivoObbligatorio"></span></td>
                                        <td colspan="4"> <textarea name="noteMisuraPsr" cols="50" class="testoCampi" onKeyUp="return testLength(noteMisuraPsr,500,'false');" onBlur="testLength(noteMisuraPsr,500,'true');">$$noteMisuraPsr</textarea>
                                        ##erroreNoteMisuraPsr
                                        </td>
                                      </tr>                                      
                                      <tr>
                                        <td  colspan="2">Note da parte del cliente</font></td>
                                        <td colspan="4"> <textarea name="note" cols="50" class="testoCampi" onKeyPress="return testLength(note,512,'false');" onBlur="testLength(note,512,'true');">##note</textarea>
                                        ##errore2</td>
                                      </tr>
                                    </form>
                                    </table>
                                    <br>
                                    <table width="98%" border="0" align="center" cellpadding="0" cellspacing="0">
                                      <tr>
                                        <td>I dati contrassegnati con (*) sono
                                          obbligatori</td>
                                      </tr>
                                    </table> <br>
                                    <table width="98%" border="0" align="center" cellpadding="0" cellspacing="0">
                                      <tr>
                                        <td><div align="center"><a href="javascript:if (salva(document.identificazioneCampione)) identificazioneCampione.submit();"><img src="../layout/im/b_conferma.gif" width="150" height="16" border="0"></a></div></td>
                                      </tr>
                                    </table> <br></td>
                                </tr>
                              </table>
                              </td>
                          </tr>
                        </table>
                      </td>
                      <td background="../layout/im/pix_verde_nuovo.gif"><img src="../layout/im/tra_pix.gif" width="2" height="1"></td>

                      <td background="../layout/im/pix-gri-ban.gif"><img src="../layout/im/tra_pix.gif" width="1" height="1"></td>
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
          </td>
        </tr>
        <tr bgcolor="#333333">
          <td><img src="../layout/im/banner_inf.jpg" width="618" height="14" border="0" alt="www.ruparpiemonte.it"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<span class="testoneroCopia"></span><span class="testonero"></span>
<form name="aggiorna" method="post" action="">
	<input type="hidden" name="idRichiestaSearch" value="-1">
	<input type="hidden" name="ritorno" value="-1">
</form>
</body>
<script type="text/javascript">
    var motivoObbligatorioSelected = '';

  function isMotivoObbligatorio(motivoObbligatorio)
  {
    motivoObbligatorioSelected = motivoObbligatorio;

    if (motivoObbligatorio == 'S')
    {
        document.getElementById("idMotivoObbligatorio").innerHTML = '(*)';  
    }
    else
    {
        document.getElementById("idMotivoObbligatorio").innerHTML = '';
    }
  }

function salva(form)
{
    var msg = '';

    if (form.codiceMisuraPsr.value == -1)
    {
      msg = msg + 'Selezionare un adempimento per misura PSR\n';
    }
    else if (motivoObbligatorioSelected == 'S' && form.noteMisuraPsr.value.trim() == '')
        {
        msg = msg + 'La motivazione adempimento misura PSR è obbligatoria per l\'adempimento selezionato \n';
        }
    if (msg != '')
    {
      alert("Dati incompleti\n\n" + msg);
      return false;
    }
    else
    {
        return true;
    }  
}

function controlli(form,modo,percorso){
    var ritorno = '../controller/identificazioneCampione.jsp';
    var idRichiesta = document.getElementById("idRichiesta").value;
    var iuv = document.getElementById("iuv").value;
    var stato_pagamento = document.getElementById("stato_pagamento").value;
    var tipo_pagamento = document.getElementById("tipo_pagamento").value;
    if(modo=='aggiorna' || modo=='scarica'){
        if(iuv!=null && iuv!=""){
            if(modo=='scarica'){
                if(tipo_pagamento=="M1" && stato_pagamento=='N'){
                    alert("Il pagamento on line e' in attesa, non e' ancora pervenuto; utilizza la funzione Verifica il Pagamento per aggiornare lo stato del pagamento");
                    return null;
                }else if(tipo_pagamento=="M3" && stato_pagamento=='N'){
                    alert("Esiste un avviso di pagamento non pagato, ristampalo e paga con i canali di PagoPA oppure annullalo");
                    return null;
                }else{
                    pop('../report/avvisoPagamento.pdf?tipoPagamento='+tipo_pagamento+'&tipoDocumento=RT&idRichiesta='+idRichiesta,647,480,'pdf');
                }
            }if(modo=='aggiorna'){
                if(stato_pagamento=='S'){
                    alert("Il pagamento e' stato ricevuto on line - puoi procedere con l'inoltro del campione");
                    return null;
                }else{
                    form.action=percorso;
                    form.idRichiestaSearch.value=idRichiesta;
                    form.ritorno.value=ritorno;
                    form.submit();
                }
            }
        }else{
             alert("Non ci sono transazioni di pagamento valide");
             return null;
        }
    }
}
@@avvisoControlli
//questo alert serve solo nel caso in cui si ritorni da verificaPagamento.jsp
//con qualche alert da mostrare all'utente. Il giro è un po' contorto ma ahimé non ho avuto altre idee
alert("$$alertAvvisoControlli");
@@avvisoControlli
</script>
</html>
